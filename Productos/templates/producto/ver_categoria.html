{% extends "producto/base.html" %}
{% load static %}

{% block content %}
<h2 class="mb-3">{{ categoria.nombre }}</h2>

{# üîº Bot√≥n volver arriba #}
<div class="mb-4">
  <a href="{% url 'listar_categorias' %}" class="btn btn-outline-secondary btn-sm">
    ‚Üê Volver a Productos
  </a>
</div>

{# Subcategor√≠as (ahora visibles para todos los logueados) #}
{% if subcategorias %}
  <h4>Subcategor√≠as</h4>
  <div class="d-flex flex-wrap mb-4">
      {% for sub in subcategorias %}
          <a href="{% url 'ver_categoria' sub.id %}" class="badge bg-primary text-decoration-none me-2 mb-2 p-2">
              {{ sub.nombre }}
          </a>
      {% endfor %}
  </div>
{% endif %}

{# Productos #}
{% if productos %}
  <h4>Productos</h4>
  <div class="row">
      {% for p in productos %}
          <div class="col-md-4 mb-4">
              <div class="card shadow-sm border-0 h-100 text-center">
                  {% if p.imagen %}
                      <img src="{{ p.imagen.url }}" class="card-img-top" alt="{{ p.nombre }}" style="height:200px; object-fit:cover;">
                  {% else %}
                      <img src="{% static 'img/default-product.png' %}" class="card-img-top" alt="Sin imagen" style="height:200px; object-fit:cover;">
                  {% endif %}
                  <div class="card-body">
                      <h5 class="card-title">{{ p.nombre }}</h5>
                      <p class="card-text text-muted">Precio: <strong>{{ p.precio_venta }} Bs.</strong></p>
                      {% if request.user.is_authenticated and request.user.empleado %}
                          <p class="card-text">Cantidad: {{ p.cantidad }} {{ p.unidad_medida }}</p>
                      {% endif %}
                  </div>
              </div>
          </div>
      {% endfor %}
  </div>
{% else %}
  <p>No hay productos disponibles.</p>
{% endif %}

{# Botones del gerente #}
{% if request.user.is_authenticated and request.user.empleado.cargo.cargo == "Gerente" %}
  <div class="mt-3 d-flex flex-wrap gap-2">
      <a href="{% url 'crear_producto' categoria.id %}" class="btn btn-primary btn-sm">‚ûï Agregar producto</a>
      {% if not categoria.categoria_padre %}
          <a href="{% url 'crear_subcategoria' categoria.id %}" class="btn btn-success btn-sm">‚ûï Agregar subcategor√≠a</a>
      {% endif %}
  </div>
{% endif %}

{# üîΩ Bot√≥n volver abajo #}
<div class="mt-4">
  <a href="{% url 'listar_categorias' %}" class="btn btn-outline-secondary btn-sm">
    ‚Üê Volver a Productos
  </a>
</div>

{% endblock %}
